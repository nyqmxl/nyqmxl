# TikTok文档说明

## 文件树

```
src
├── browser.py
├── test.py
├── autoxjs.apk
│   └── tiktok.js
└── ws_client.py
```

## 1. browser.py

### 功能
`browser.py` 使用 `uiautomation` 库来控制 Chrome 浏览器，模拟人类行为进行滚动操作。该脚本的主要功能是捕获 Chrome 窗口并模拟滚动操作，避免机械重复，增加自然延迟。

### 详细功能分析

#### 1.1 窗口捕获
- **功能**：捕获 Chrome 窗口，确保窗口存在且标题包含 "TikTok"。
- **实现**：通过 `WindowControl` 类捕获窗口，使用正则表达式匹配窗口标题。

#### 1.2 人类行为模拟
- **功能**：模拟人类行为，避免机械重复，增加自然延迟。
- **实现**：通过 `PaneControl` 类获取内容区域，使用随机参数模拟鼠标拖动操作，并添加随机延迟。

### 使用方法
1. 确保安装了 `uiautomation` 库。
2. 运行脚本：
   ```bash
   python browser.py
   ```

### 注意事项
- 确保 Chrome 浏览器窗口存在且标题包含 "TikTok"。
- 该脚本可能会被检测为自动化工具，存在被封禁的风险。

## 2. test.py

### 功能
`test.py` 使用 `websockets` 库创建一个 WebSocket 服务器，用于与客户端通信。该脚本的主要功能是接收客户端消息并发送回复，每 5 秒发送一次消息。

### 详细功能分析

#### 2.1 WebSocket服务器
- **功能**：创建一个 WebSocket 服务器，监听端口 8500。
- **实现**：使用 `websockets` 库创建服务器，定义处理函数 `handler`。

#### 2.2 消息处理
- **功能**：接收客户端消息并发送回复。
- **实现**：在 `handler` 函数中，使用 `while True` 循环接收消息，发送回复消息，并添加延迟。

### 使用方法
1. 确保安装了 `websockets` 库。
2. 运行脚本：
   ```bash
   python test.py
   ```

### 注意事项
- 该脚本没有对消息内容进行验证，可能存在安全风险。

## 3. autoxjs.apk 的 tiktok.js

### 功能
`tiktok.js` 使用 AutoX 自动化工具操作 TikTok 应用。该脚本的主要功能是模拟用户操作，包括解锁屏幕、设置浏览器、登录和注册 TikTok 账号。

### 详细功能分析

#### 3.1 解锁屏幕
- **功能**：解锁屏幕并保持屏幕常亮。
- **实现**：使用 `device.wakeUp()` 和 `swipe` 方法解锁屏幕，并调用 `device.keepScreenOn()` 保持屏幕常亮。

#### 3.2 设置浏览器
- **功能**：设置 Edge 浏览器为默认浏览器，并配置启动页面。
- **实现**：通过 `app.launch` 方法启动应用，使用 `click_element` 方法点击菜单项，配置浏览器设置。

#### 3.3 TikTok欢迎页面
- **功能**：处理 TikTok 欢迎页面，跳过引导步骤。
- **实现**：使用 `sleep` 方法等待页面加载，点击跳过按钮，模拟用户操作。

#### 3.4 TikTok注册
- **功能**：注册 TikTok 账号。
- **实现**：通过 `click_element` 方法点击注册按钮，输入用户名和密码，完成注册流程。

#### 3.5 TikTok登录
- **功能**：登录 TikTok 账号。
- **实现**：通过 `click_element` 方法点击登录按钮，输入邮箱和验证码，完成登录流程。

#### 3.6 TikTok二维码登录
- **功能**：通过二维码登录 TikTok。
- **实现**：通过 `app.startActivity` 方法启动应用，扫描二维码并确认登录。

### 使用方法
1. 确保安装了 AutoX 自动化工具。
2. 将脚本加载到 AutoX 中并运行。

### 注意事项
- 该脚本可能会被检测为自动化工具，存在被封禁的风险。
- 建议增加异常处理，确保脚本在操作失败时不会崩溃。

## 4. ws_client.py

### 功能
`ws_client.py` 使用 `websockets` 库创建一个 WebSocket 客户端，用于与服务器通信。该脚本的主要功能是发送和接收消息，使用 TOTP 进行身份验证。

### 详细功能分析

#### 4.1 TOTP身份验证
- **功能**：生成和验证 TOTP 验证码。
- **实现**：通过 `pyotp` 库生成和验证 TOTP 验证码，使用 `uuid1` 生成唯一标识符。

#### 4.2 WebSocket客户端
- **功能**：创建 WebSocket 客户端，发送和接收消息。
- **实现**：使用 `websockets` 库创建客户端，连接到服务器，发送和接收消息。

### 使用方法
1. 确保安装了 `websockets` 和 `pyotp` 库。
2. 运行脚本：
   ```bash
   python ws_client.py
   ```

### 注意事项
- 该脚本使用 TOTP 进行身份验证，增加了安全性。
- 建议增加消息验证机制，确保只处理合法消息。

